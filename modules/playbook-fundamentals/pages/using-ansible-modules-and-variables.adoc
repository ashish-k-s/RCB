#  Using Ansible modules and variables

**Title:** Understanding Ansible Modules and Variables

**Description:** This guide aims to elucidate the utilization of Ansible modules and variables, providing a solid foundation for users to effectively harness their power in automating configuration management tasks.

---

##  Using Ansible Modules and Facts

Ansible, an open-source automation tool, leverages modules to perform various tasks during the execution of playbooks. These modules are self-contained programs that can be called on the command line or from within a playbook. This section will focus on understanding how to use Ansible modules and variables for effective automation.

### 1. Understanding Ansible Modules

Ansible modules provide the building blocks for interacting with remote systems, performing common system administration tasks, and managing applications. They can be categorized into several groups based on their functionality:

- **Command Modules:** These modules execute commands or shell scripts on managed nodes.
  ```yaml
  - name: Gather system facts
    command: uname -a
  ```
  
- **Module Modules:** These modules perform specific administrative tasks like package management, service control, and file manipulation.
  ```yaml
  - name: Install Apache web server
    yum:
      name: httpd
      state: present
  ```

- **Copy & Template Modules:** These modules handle file operations such as copying files or creating templates from Jinja2 templates.
  ```yaml
  - name: Copy a configuration file to remote nodes
    copy:
      src: /etc/nginx/conf.d/default.conf
      dest: /etc/nginx/conf.d/example.com.conf
  ```

### 2. Variables in Ansible

Variables play a crucial role in making Ansible playbooks reusable and dynamic, allowing configuration for different environments or targets. You can define variables at various levels:

- **Playbook Variables:** Variables defined within the playbook itself using the `vars:` keyword.
  ```yaml
  - hosts: webservers
    vars:
       apache_config_template: /etc/nginx/conf.d/example.com.conf
  ```

- **Group Variables:** Variables shared across all hosts in a particular group.
  ```yaml
  hosts:
    webservers:
      vars:
        apache_config_template: /etc/nginx/conf.d/example.com.conf
  ```

- **Inventory Variables:** Variables sourced from inventory files, enabling dynamic targeting of hosts based on OS or other criteria.
  ```ini
  [webservers]
  web1.example.com ansible_host=192.168.1.10
  web2.example.com ansible_host=192.168.1.11
  ```

### 3. Using Variables in Modules

Variables can be utilized within modules to make configurations more flexible and reusable. For instance, using variables to define paths or service names:
```yaml
- name: Ensure Apache is installed and running
  yum:
    name: httpd
    state: present
  tags: apache

- name: Start Apache service
  service:
    name: httpd
    state: started
    enabled: yes
  tags: apache

- name: Copy custom configuration file for Apache
  copy:
    src: "{{ apache_config_template }}"
    dest: "/etc/httpd/conf.d/example.com.conf"
    owner: root
    group: root
    mode: '0644'
  notify: restart httpd
  tags: apache
```

In this example, the `apache_config_template` variable stores the path to a custom configuration file which is then utilized in the `copy` module to ensure consistent deployment across environments.

### 4. Hands-on Activity

**Objective:** Configure a web server using Ansible modules and variables.

#### Prerequisites:
- An Ansible control node (your local machine or a server) with Ansible installed.
- Access to a managed node (e.g., virtual machines or cloud instances) running a compatible OS like CentOS 8 or Ubuntu 20.04 LTS.
- Basic understanding of SSH and network configuration.

#### Steps:
1. **Set up Inventory:** Create an inventory file listing your managed nodes.

   ```ini
   [webservers]
   web1 ansible_user=yourusername ansible_host=192.168.1.10
   web2 ansible_user=yourusername ansible_host=192.168.1.11
   ```

2. **Create Playbook:** Write a playbook that installs and configures the Apache web server using modules and variables.

   ```yaml
   ---
   - name: Configure Apache Web Server
     hosts: webservers
     become: yes

     vars:
       apache_config_template: /etc/httpd/conf.d/example.com.conf

     tasks:
       - name: Install Apache
         yum:
           name: httpd
           state: present

       - name: Start and enable Apache service
         service:
           name: httpd
           state: started
           enabled: yes

       - name: Copy custom configuration file for Apache
         copy:
           src: "{{ apache_config_template }}"
           dest: "/etc/httpd/conf.d/example.com.conf"
           owner: root
           group: root
           mode: '0644'
         notify: restart httpd
   ```

3. **Run Playbook:** Execute the playbook using the `ansible-playbook` command.

   ```bash
   ansible-playbook -i inventory.ini apache_config.yml
   ```

#### Verification:
Access your web server at `http://<webserver_ip>` to confirm that Apache is running and serving a customized configuration based on the variables defined in your playbook.

---

This guide provides an introduction to using Ansible modules and variables, illustrating how to create dynamic and reusable automation tasks. By following the hands-on activity, you can solidify your understanding of these core concepts and apply them in practical scenarios.